<html>
<head>
	<script id="vertexShader" type="x-shader/x-vertex">
    precision highp float;

    varying vec2 vUv;

    void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
    }
    </script>

	<script id="fragmentShader" type="x-shader/x-fragment">
    precision highp float;

    uniform sampler2D texture1;
    uniform float multiplier;

    varying vec2 vUv;

    void main() {
        vec4 pxl = texture2D(texture1, vUv);
        
        vec3 rgb = pxl.xyz;
        
        //** do color shifts here..
        
        float red = rgb[0];
        float green = rgb[1];
        
        float diff = multiplier*(red - green);

        rgb[0] += diff;
        rgb[1] -= diff;
        
        //**
    
        pxl.xyz = rgb;
        gl_FragColor = pxl;
    }
    </script>
  
    <script src="http://threejs.org/build/three.min.js"></script>
    <script src="https://rawgit.com/dataarts/dat.gui/master/build/dat.gui.min.js"></script>

    <script>
    var renderer, scene, camera;
    var video, vtexture;
    var controls;
    var material;

    function ControlState()
    {
        this.multiplier = 1.0;
    }
            

    function init_video()
    {
        video = document.createElement('video');
        video.autoplay = true;
        video.loop = true;
    
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

        navigator.getUserMedia({video: true}, function(stream){
          video.src    = window.URL.createObjectURL(stream);
        }, function(error){
          console.log("Failed to get a stream due to", error);
        });
        
        vtexture = new THREE.Texture(video);
    }
       
    function init_renderer()
    {
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
    }
        
    function init_contents()
    {
        // Initialize Scenes
        scene = new THREE.Scene();

        // Initialize Camera
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.z = 300;

        // Initialize Shaders
        material = new THREE.ShaderMaterial({
            uniforms: {
                texture1: { type: "t", value: vtexture },
                multiplier : { type: "f", value: 1.0 }},
            vertexShader: document.getElementById('vertexShader').innerHTML,
            fragmentShader: document.getElementById('fragmentShader').innerHTML
        });

        // Init Mesh
        var plane = new THREE.PlaneGeometry(320, 240);
        var mesh = new THREE.Mesh( plane, material );
        
        scene.add( mesh );
    }
        
    function init_gui()
    {
        controls = new ControlState();
        gui = new dat.GUI();
        gui.add(controls, 'multiplier', 0, 5);
    }
            
        
    function init()
    {
        init_video();        
        init_renderer();
        init_contents();
        init_gui();
    }        
        
    function animate()
    {
        requestAnimationFrame( animate );
        
        if (video.readyState === video.HAVE_ENOUGH_DATA)
        {
            vtexture.needsUpdate = true;
        }
        
        material.uniforms.multiplier.value = controls.multiplier;

        renderer.render( scene, camera );
    }
        
	document.addEventListener("DOMContentLoaded", function(event){
        init();        
        animate();
    });
    </script>
</head>
<body style="margin:0"></body>
</html>