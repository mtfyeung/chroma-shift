<!DOCTYPE html>
<html>
<head>
	<script id="vertexShader" type="x-shader/x-vertex">
#ifdef GL_ES
		precision highp float;
#endif

    varying vec2 vUv;

    void main() {
        vUv = uv;

        gl_Position =   projectionMatrix * 
                        modelViewMatrix * 
                        vec4(position,1.0);
    }
    </script>

	<script id="fragmentShader" type="x-shader/x-fragment">
#ifdef GL_ES
		precision highp float;
#endif

    uniform sampler2D texture1;

    varying vec2 vUv;
    
    vec3 RGBtoLMS(vec3 v)
    {
        mat3 m = mat3(
            0.313988, 0.155371, 0.0177525,
            0.63952, 0.757903, 0.109443,
            0.0464937, 0.0866942, 0.872498
        );
    
        return m * v;
    }
    
    vec3 LMStoRGB(vec3 v)
    {
        mat3 m = mat3(
            5.47226, -1.12523, 0.029802,
            -4.642, 2.29314, -0.167893,
            0.029802, -0.193194, 1.16374
        );
    
        return m * v;
    }

    void main() {
        vec4 pxl = texture2D(texture1, vUv);
        
        vec3 rgb = pxl.xyz;
        vec3 lms = RGBtoLMS(rgb); 
        
        //** do color shifts here..
        
        float red = rgb[0];
        float green = rgb[1];
        
        float diff = abs(red - green);
        
        
        const float threshold = 0.25;
        if (diff < threshold)
        {
            if (red > green)
            {
                if (red < 0.5 + threshold)
                {
                    rgb[0] += threshold;
                }
                else
                {
                    rgb[1] -= threshold;
                }
            }
            else
            {
                if (green < 0.5 + threshold)
                {
                    rgb[1] += threshold;
                }
                else
                {
                    rgb[0] -= threshold;
                }
            }
        }
        
        //**
        
        //rgb = LMStoRGB(lms);
    
        pxl.xyz = rgb;
        gl_FragColor = pxl;
    }
    </script>
  
    <script src="three.min.js"></script>

    <script>
    var renderer, scene, camera;
        
    function init()
    {
        // Initialize WebGL Renderer
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Initialize Scenes
        scene = new THREE.Scene();

        // Initialize Camera
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 100);
        camera.position.z = 100;

        // Initialize Shaders
        var material = new THREE.ShaderMaterial({
            uniforms: { texture1: { type: "t", value: THREE.ImageUtils.loadTexture( "Ishihara_9.png" ) }},
            vertexShader: document.getElementById('vertexShader').innerHTML,
            fragmentShader: document.getElementById('fragmentShader').innerHTML
        });

        // Init Mesh
        var plane = new THREE.PlaneGeometry(80, 80);
        var mesh = new THREE.Mesh( plane, material );
        
        scene.add( mesh );
    }
        
        
    function animate() {

        requestAnimationFrame( animate );

        renderer.render( scene, camera );

    }
        
	document.addEventListener("DOMContentLoaded", function(event) {

        init();
        
        animate();
    });
    </script>
</head>
<body></body>
</html>